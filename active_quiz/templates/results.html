{% extends "base.html" %}
{% load static %}
{% block extra_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/active_quiz/results.css' %}">
{% endblock %}
{% block content %}
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
    <div class="results-page">
        <div class="celebration-header">
            <div class="trophy-icon">ğŸ†</div>
            <h1 class="quiz-title">Quiz Complete!</h1>
            <p class="subtitle">Here are the final standings</p>
        </div>

        <div class="podium-container">
            {% if players|length >= 2 %}
                <div class="podium-place second-place">
                    <div class="player-photo-container">
                        {% if players.1.player_photo %}
                            <img src="{{ players.1.player_photo.url }}" alt="{{ players.1.user.username }}" class="player-photo">
                        {% else %}
                            <div class="photo-placeholder">{{ players.1.user.username|first|upper }}</div>
                        {% endif %}
                        <div class="medal silver-medal">ğŸ¥ˆ</div>
                    </div>
                    <h3 class="player-name">{{ players.1.user.username }}</h3>
                    <div class="player-stats">
                        <span class="score-label">Score</span>
                        <span class="score-value">{{ players.1.player_score|floatformat:1 }}</span>
                    </div>
                    <div class="podium-bar silver-bar">
                        <span class="rank">2</span>
                    </div>
                </div>
            {% endif %}

            {% if players|length >= 1 %}
                <div class="podium-place first-place">
                    <div class="crown">ğŸ‘‘</div>
                    <div class="player-photo-container">
                        {% if players.0.player_photo %}
                            <img src="{{ players.0.player_photo.url }}" alt="{{ players.0.user.username }}" class="player-photo">
                        {% else %}
                            <div class="photo-placeholder">{{ players.0.user.username|first|upper }}</div>
                        {% endif %}
                        <div class="medal gold-medal">ğŸ¥‡</div>
                    </div>
                    <h3 class="player-name">{{ players.0.user.username }}</h3>
                    <div class="player-stats">
                        <span class="score-label">Score</span>
                        <span class="score-value">{{ players.0.player_score|floatformat:1 }}</span>
                    </div>
                    <div class="podium-bar gold-bar">
                        <span class="rank">1</span>
                    </div>
                </div>
            {% endif %}

            {% if players|length >= 3 %}
                <div class="podium-place third-place">
                    <div class="player-photo-container">
                        {% if players.2.player_photo %}
                            <img src="{{ players.2.player_photo.url }}" alt="{{ players.2.user.username }}" class="player-photo">
                        {% else %}
                            <div class="photo-placeholder">{{ players.2.user.username|first|upper }}</div>
                        {% endif %}
                        <div class="medal bronze-medal">ğŸ¥‰</div>
                    </div>
                    <h3 class="player-name">{{ players.2.user.username }}</h3>
                    <div class="player-stats">
                        <span class="score-label">Score</span>
                        <span class="score-value">{{ players.2.player_score|floatformat:1 }}</span>
                    </div>
                    <div class="podium-bar bronze-bar">
                        <span class="rank">3</span>
                    </div>
                </div>
            {% endif %}
        </div>

        {% if players|length > 3 %}
        <div class="remaining-players">
            <h2 class="section-title">Other Finishers</h2>
            <div class="player-list">
                {% for player in players %}
                    {% if forloop.counter > 3 %}
                        <div class="player-card" data-rank="{{ forloop.counter }}">
                            <div class="rank-badge">{{ forloop.counter }}</div>
                            <div class="player-info">
                                {% if player.player_photo %}
                                    <img src="{{ player.player_photo.url }}" alt="{{ player.user.username }}" class="small-photo">
                                {% else %}
                                    <div class="small-placeholder">{{ player.user.username|first|upper }}</div>
                                {% endif %}
                                <span class="name">{{ player.user.username }}</span>
                            </div>
                            <div class="score-badge">{{ player.player_score|floatformat:1 }}</div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        // Trigger confetti on page load
        setTimeout(() => {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }, 500);

        // Trigger more confetti after a delay
        setTimeout(() => {
            confetti({
                particleCount: 50,
                angle: 60,
                spread: 55,
                origin: { x: 0 }
            });
            confetti({
                particleCount: 50,
                angle: 120,
                spread: 55,
                origin: { x: 1 }
            });
        }, 1500);
    </script>
{% endblock %}