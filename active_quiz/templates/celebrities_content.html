{% load static %}
{% block extra_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/active_quiz/celebrities.css' %}">
{% endblock %}

{% if current_celebrity %}
    <div class="celebrity-card">
        <img class="celebrity-image" src="{{ current_celebrity.photo.url }}" alt="Celebrity Image">
        {% if request.user.username != 'david' %}
            <div class="letter-boxes-container">
                <div id="first-name-boxes" class="name-section"></div>
                <div id="last-name-boxes" class="name-section"></div>
            </div>
        {% endif %}
    </div>
    <div class="celebrity-form-container">
        <form id="quiz-form" method="post" action="{% url 'active_quiz:next_celebrity' %}">
            {% csrf_token %}
            {% if request.user.username != 'david' %}
                <div class="input-group">
                    <label class="input-label" for="first_name">First Name</label>
                    <input type="text" class="celebrity-input" id="first_name" name="first_name" 
                           placeholder="Enter first name" 
                           {% if request.user.player.question_answered != 0 %}disabled{% endif %}>
                </div>
                <div class="input-group">
                    <label class="input-label" for="last_name">Last Name</label>
                    <input type="text" class="celebrity-input" id="last_name" name="last_name" 
                           placeholder="Enter last name" 
                           {% if request.user.player.question_answered != 0 %}disabled{% endif %}>
                </div>
                <button class="submit-button" id="submit" type="submit" 
                        {% if request.user.player.question_answered != 0 %}disabled{% endif %}>Submit</button>
            {% else %}
                <div class="answer-display" id="answer-display" style="display: none;">
                    <p><strong>Answer:</strong> <span id="celebrity-name"></span></p>
                </div>
                <button class="reveal-button" type="button" id="reveal-name-button" onclick="revealName()">Reveal Name</button>
                <button class="next-button" id="submit" type="submit">Next</button>
            {% endif %}
            <input type="hidden" name="correct_first_name" value="{{ current_celebrity.first_name }}">
            <input type="hidden" name="correct_last_name" value="{{ current_celebrity.last_name }}">
        </form>
    </div>
{% endif %}
<script>
    const firstName = "{{ current_celebrity.first_name }}";
    const lastName = "{{ current_celebrity.last_name }}";

    function createLetterBoxes(name, containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = '';
        
        // Split name into words
        const words = name.split(' ');
        
        words.forEach(word => {
            const wordWrapper = document.createElement('div');
            wordWrapper.className = 'word-wrapper';
            
            for (let char of word) {
                const box = document.createElement('div');
                box.className = 'letter-box';
                wordWrapper.appendChild(box);
            }
            
            container.appendChild(wordWrapper);
        });
    }

    function revealName() {
        const answerDisplay = document.getElementById('answer-display');
        const celebrityNameSpan = document.getElementById('celebrity-name');
        
        if (answerDisplay && celebrityNameSpan) {
            celebrityNameSpan.textContent = `${firstName} ${lastName}`;
            answerDisplay.style.display = 'block';
            answerDisplay.classList.add('fade-in');
        }
    }

    // Create letter boxes for players
    if ("{{ request.user.username }}" !== 'david') {
        createLetterBoxes(firstName, 'first-name-boxes');
        createLetterBoxes(lastName, 'last-name-boxes');
    }
</script>