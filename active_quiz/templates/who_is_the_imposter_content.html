{% load static %}
{% block extra_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/active_quiz/active_quiz.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/active_quiz/who_is_the_imposter.css' %}">
{% endblock %}

{% if current_movie %}
    <div class="question-card">
        <h2 class="quiz-question">Who is the Imposter?</h2>
    </div>

    <form id="imposter-form" method="post" action="{% url 'active_quiz:next_who_is_the_imposter' %}">
        {% csrf_token %}
        <input type="hidden" name="imposter_id" value="{{ imposter.id }}">
        
        <div class="celebrities-grid">
            {% for celebrity in celebrities %}
                <div class="celebrity-card" onclick="selectCelebrity({{ celebrity.id }})">
                    <img class="celebrity-photo" src="{{ celebrity.photo.url }}" alt="{{ celebrity.first_name }} {{ celebrity.last_name }}">
                    <div class="celebrity-name">{{ celebrity.first_name }} {{ celebrity.last_name }}</div>
                    <input type="radio" name="selected_celebrity_id" value="{{ celebrity.id }}" id="celebrity-{{ celebrity.id }}" class="celebrity-radio">
                </div>
            {% endfor %}
        </div>
        
        {% if request.user.username == 'david' %}
            <div class="answer-display" id="answer-display" style="display: none;">
                <p class="answer-text">{{ imposter.first_name }} {{ imposter.last_name }}</p>
            </div>
            <button type="button" class="reveal-button" onclick="revealImposter()">Reveal Imposter</button>
            <button type="submit" class="next-button">Next</button>
        {% else %}
            <button type="submit" class="submit-button">Submit</button>
        {% endif %}
    </form>
{% endif %}

<script>
    function selectCelebrity(id) {
        // Remove selection from all cards
        document.querySelectorAll('.celebrity-card').forEach(card => {
            card.classList.remove('selected');
        });
        
        // Add selection to clicked card
        const selectedCard = document.getElementById('celebrity-' + id).closest('.celebrity-card');
        selectedCard.classList.add('selected');
        
        // Check the radio button
        document.getElementById('celebrity-' + id).checked = true;
    }

    function revealImposter() {
        const imposterId = document.querySelector('input[name="imposter_id"]').value;
        const imposterCard = document.getElementById('celebrity-' + imposterId).closest('.celebrity-card');
        
        // Highlight the imposter
        imposterCard.classList.add('highlight-imposter');
        
        // Show answer display
        const answerDisplay = document.getElementById('answer-display');
        answerDisplay.style.display = 'block';
        setTimeout(() => {
            answerDisplay.style.opacity = '1';
        }, 10);
    }
</script>